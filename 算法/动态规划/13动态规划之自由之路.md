# è‡ªç”±ä¹‹è·¯

| ç‰›å®¢ç½‘ |                           LeetCode                           |                             åŠ›æ‰£                             | éš¾åº¦ |
| :----: | :----------------------------------------------------------: | :----------------------------------------------------------: | :--: |
|   -    | [514. Freedom Trail](https://leetcode.com/problems/freedom-trail/) | [514. è‡ªç”±ä¹‹è·¯](https://leetcode-cn.com/problems/freedom-trail/) |  ğŸ”´   |

ä»Šå¤©è¦è®²çš„åŠ›æ‰£ç¬¬ 514 é¢˜ã€Œ [è‡ªç”±ä¹‹è·¯](https://leetcode-cn.com/problems/freedom-trail/)ã€

é¢˜ç›®ç»™ä½ è¾“å…¥ä¸€ä¸ªå­—ç¬¦ä¸² `ring` ä»£è¡¨åœ†ç›˜ä¸Šçš„å­—ç¬¦ï¼ˆæŒ‡é’ˆä½ç½®åœ¨ 12 ç‚¹é’Ÿæ–¹å‘ï¼Œåˆå§‹æŒ‡å‘ `ring[0]`ï¼‰ï¼Œå†è¾“å…¥ä¸€ä¸ªå­—ç¬¦ä¸² `key` ä»£è¡¨ä½ éœ€è¦æ‹¨åŠ¨åœ†ç›˜è¾“å…¥çš„å­—ç¬¦ä¸²ï¼Œä½ çš„ç®—æ³•éœ€è¦è¿”å›è¾“å…¥è¿™ä¸ª `key` è‡³å°‘è¿›è¡Œå¤šå°‘æ¬¡æ“ä½œï¼ˆæ‹¨åŠ¨ä¸€æ ¼åœ†ç›˜å’ŒæŒ‰ä¸‹åœ†ç›˜ä¸­é—´çš„æŒ‰é’®éƒ½ç®—æ˜¯ä¸€æ¬¡æ“ä½œï¼‰ã€‚

å‡½æ•°ç­¾åå¦‚ä¸‹ï¼š

```java
int findRotateSteps(String ring, String key);
```

æ¯”å¦‚é¢˜ç›®ä¸¾çš„ä¾‹å­ï¼Œè¾“å…¥ `ring = "godding", key = "gd"`ï¼Œå¯¹åº”çš„åœ†ç›˜å¦‚ä¸‹ï¼ˆå¤§å†™åªæ˜¯ä¸ºäº†æ¸…æ™°ï¼Œå®é™…ä¸Šè¾“å…¥çš„å­—ç¬¦ä¸²éƒ½æ˜¯å°å†™å­—æ¯ï¼‰ï¼š

[![img](https://labuladong.github.io/algo/images/%e8%bd%ac%e7%9b%98/3.jpg)](https://labuladong.github.io/algo/images/è½¬ç›˜/3.jpg)

æˆ‘ä»¬éœ€è¦è¾“å…¥ `key = "gd"`ï¼Œç®—æ³•è¿”å› 4ã€‚

å› ä¸ºç°åœ¨æŒ‡é’ˆæŒ‡çš„å­—æ¯å°±æ˜¯å­—æ¯ `"g"`ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥æŒ‰ä¸‹ä¸­é—´çš„æŒ‰é’®ï¼Œç„¶åå†å°†åœ†ç›˜é€†æ—¶é’ˆæ‹¨åŠ¨ä¸¤æ ¼ï¼Œè®©æŒ‡é’ˆæŒ‡å‘å­—æ¯ `"d"`ï¼Œç„¶åå†æŒ‰ä¸€æ¬¡ä¸­é—´çš„æŒ‰é’®ã€‚

ä¸Šè¿°è¿‡ç¨‹ï¼ŒæŒ‰äº†ä¸¤æ¬¡æŒ‰é’®ï¼Œæ‹¨äº†ä¸¤æ ¼è½¬ç›˜ï¼Œæ€»å…±æ“ä½œäº† 4 æ¬¡ï¼Œæ˜¯æœ€å°‘çš„æ“ä½œæ¬¡æ•°ï¼Œæ‰€ä»¥ç®—æ³•åº”è¯¥è¿”å› 4ã€‚

æˆ‘ä»¬è¿™é‡Œå¯ä»¥é¦–å…ˆç»™é¢˜ç›®åšä¸€ä¸ªç­‰ä»·ï¼Œè½¬åŠ¨åœ†ç›˜æ˜¯ä¸æ˜¯å°±ç­‰äºæ‹¨åŠ¨æŒ‡é’ˆï¼Ÿ

**åŸé¢˜å¯ä»¥è½¬åŒ–ä¸ºï¼šåœ†ç›˜å›ºå®šï¼Œæˆ‘ä»¬å¯ä»¥æ‹¨åŠ¨æŒ‡é’ˆï¼›ç°åœ¨éœ€è¦æˆ‘ä»¬æ‹¨åŠ¨æŒ‡é’ˆå¹¶æŒ‰ä¸‹æŒ‰é’®ï¼Œä»¥æœ€å°‘çš„æ“ä½œæ¬¡æ•°è¾“å…¥ `key` å¯¹åº”çš„å­—ç¬¦ä¸²**ã€‚

é‚£ä¹ˆï¼Œè¿™ä¸ªé—®é¢˜å¦‚ä½•ä½¿ç”¨åŠ¨æ€è§„åˆ’çš„æŠ€å·§è§£å†³å‘¢ï¼Ÿæˆ–è€…è¯´ï¼Œè¿™é“é¢˜çš„ã€ŒçŠ¶æ€ã€å’Œã€Œé€‰æ‹©ã€æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ

**ã€ŒçŠ¶æ€ã€å°±æ˜¯ã€Œå½“å‰éœ€è¦è¾“å…¥çš„å­—ç¬¦ã€å’Œã€Œå½“å‰åœ†ç›˜æŒ‡é’ˆçš„ä½ç½®ã€**ã€‚

å†å…·ä½“ç‚¹ï¼Œã€ŒçŠ¶æ€ã€å°±æ˜¯ `i` å’Œ `j` ä¸¤ä¸ªå˜é‡ã€‚æˆ‘ä»¬å¯ä»¥ç”¨ `i` è¡¨ç¤ºå½“å‰åœ†ç›˜ä¸ŠæŒ‡é’ˆæŒ‡å‘çš„å­—ç¬¦ï¼ˆä¹Ÿå°±æ˜¯ `ring[i]`ï¼‰ï¼›ç”¨ `j` è¡¨ç¤ºéœ€è¦è¾“å…¥çš„å­—ç¬¦ï¼ˆä¹Ÿå°±æ˜¯ `key[j]`ï¼‰ã€‚

è¿™æ ·æˆ‘ä»¬å¯ä»¥å†™è¿™æ ·ä¸€ä¸ª `dp` å‡½æ•°ï¼š

```java
int dp(String ring, int i, String key, int j);
```

è¿™ä¸ª `dp` å‡½æ•°çš„å®šä¹‰å¦‚ä¸‹ï¼š

**å½“åœ†ç›˜æŒ‡é’ˆæŒ‡å‘ `ring[i]` æ—¶ï¼Œè¾“å…¥å­—ç¬¦ä¸² `key[j..]` è‡³å°‘éœ€è¦ `dp(ring, i, key, j)` æ¬¡æ“ä½œ**ã€‚

æ ¹æ®è¿™ä¸ªå®šä¹‰ï¼Œé¢˜ç›®å…¶å®å°±æ˜¯æƒ³è®¡ç®— `dp(ring, 0, key, 0)` çš„å€¼ï¼Œè€Œä¸”æˆ‘ä»¬å¯ä»¥æŠŠ `dp` å‡½æ•°çš„ base case å†™å‡ºæ¥ï¼š

```java
int dp(String ring, int i, String, int j) {
    // base caseï¼Œå®Œæˆè¾“å…¥
    if (j == key.length()) return 0;
    // ...
}
```

æ¥ä¸‹æ¥ï¼Œæ€è€ƒä¸€ä¸‹å¦‚ä½•æ ¹æ®çŠ¶æ€åšé€‰æ‹©ï¼Œå¦‚ä½•è¿›è¡ŒçŠ¶æ€è½¬ç§»ï¼Ÿ

**ã€Œé€‰æ‹©ã€å°±æ˜¯ã€Œå¦‚ä½•æ‹¨åŠ¨æŒ‡é’ˆå¾—åˆ°å¾…è¾“å…¥çš„å­—ç¬¦ã€**ã€‚

å†å…·ä½“ç‚¹å°±æ˜¯ï¼Œå¯¹äºç°åœ¨æƒ³è¾“å…¥çš„å­—ç¬¦ `key[j]`ï¼Œæˆ‘ä»¬å¯ä»¥å¦‚ä½•æ‹¨åŠ¨åœ†ç›˜ï¼Œå¾—åˆ°è¿™ä¸ªå­—ç¬¦ï¼Ÿ

æ¯”å¦‚è¯´è¾“å…¥ `ring = "gdonidg"`ï¼Œç°åœ¨åœ†ç›˜çš„çŠ¶æ€å¦‚ä¸‹å›¾ï¼š

[![img](https://labuladong.github.io/algo/images/%e8%bd%ac%e7%9b%98/4.jpeg)](https://labuladong.github.io/algo/images/è½¬ç›˜/4.jpeg)

å‡è®¾æˆ‘æƒ³è¾“å…¥çš„å­—ç¬¦ `key[j] = "d"`ï¼Œåœ†ç›˜ä¸­æœ‰ä¸¤ä¸ªå­—æ¯ `"d"`ï¼Œè€Œä¸”æˆ‘å¯ä»¥é¡ºæ—¶é’ˆä¹Ÿå¯ä»¥é€†æ—¶é’ˆæ‹¨åŠ¨æŒ‡é’ˆï¼Œæ‰€ä»¥æ€»å…±æœ‰å››ç§ã€Œé€‰æ‹©ã€è¾“å…¥å­—ç¬¦ `"d"`ï¼Œæˆ‘ä»¬éœ€è¦é€‰æ‹©æ“ä½œæ¬¡æ•°æœ€å°‘çš„é‚£ä¸ªæ‹¨æ³•ã€‚

å¤§è‡´çš„ä»£ç é€»è¾‘å¦‚ä¸‹ï¼š

```java
int dp(String ring, int i, String, int j) {
    // base case å®Œæˆè¾“å…¥
    if (j == key.length()) return 0;
    
    // åšé€‰æ‹©
    int res = Integer.MAX_VALUE;
    for (int k : [å­—ç¬¦ key[j] åœ¨ ring ä¸­çš„æ‰€æœ‰ç´¢å¼•]) {
        res = min(
            æŠŠ i é¡ºæ—¶é’ˆè½¬åˆ° k çš„ä»£ä»·,
            æŠŠ i é€†æ—¶é’ˆè½¬åˆ° k çš„ä»£ä»·
        );
    }
    
    return res;
}
```

è‡³äºåˆ°åº•æ˜¯é¡ºæ—¶é’ˆè¿˜æ˜¯é€†æ—¶é’ˆï¼Œå…¶å®éå¸¸å¥½åˆ¤æ–­ï¼Œæ€ä¹ˆè¿‘å°±æ€ä¹ˆæ¥ï¼›ä½†æ˜¯å¯¹äºåœ†ç›˜ä¸­çš„ä¸¤ä¸ªå­—ç¬¦ `"d"`ï¼Œè¿˜èƒ½æ˜¯æ€ä¹ˆè¿‘æ€ä¹ˆæ¥å—ï¼Ÿ

ä¸èƒ½ï¼Œå› ä¸ºè¿™å’Œ `key[i]` ä¹‹åéœ€è¦è¾“å…¥çš„å­—ç¬¦æœ‰å…³ï¼Œè¿˜æ˜¯ä¸Šé¢çš„ä¾‹å­ï¼š

[![img](https://labuladong.github.io/algo/images/%e8%bd%ac%e7%9b%98/4.jpeg)](https://labuladong.github.io/algo/images/è½¬ç›˜/4.jpeg)

å¦‚æœè¾“å…¥çš„æ˜¯ `key = "di"`ï¼Œé‚£ä¹ˆå³ä¾¿å³è¾¹çš„ `"d"` ç¦»å¾—è¿‘ï¼Œä¹Ÿåº”è¯¥å»å·¦è¾¹çš„ `"d"`ï¼Œå› ä¸ºå·¦è¾¹çš„ `"d"` æ—è¾¹å°±æ˜¯ `"i"`ï¼Œã€Œæ•´ä½“ã€çš„æ“ä½œæ•°æœ€å°‘ã€‚

é‚£ä¹ˆï¼Œåº”è¯¥å¦‚ä½•åˆ¤æ–­å‘¢ï¼Ÿå…¶å®å°±æ˜¯ç©·ä¸¾ï¼Œé€’å½’è°ƒç”¨ `dp` å‡½æ•°ï¼ŒæŠŠä¸¤ç§é€‰æ‹©çš„ã€Œæ•´ä½“ã€ä»£ä»·ç®—å‡ºæ¥ï¼Œç„¶åå†åšæ¯”è¾ƒå°±è¡Œäº†ã€‚

è®²åˆ°è¿™å°±å·®ä¸å¤šäº†ï¼Œç›´æ¥çœ‹ä»£ç å§ï¼š

```java
// å­—ç¬¦ -> ç´¢å¼•åˆ—è¡¨
HashMap<Character, ArrayList<Integer>> charToIndex = new HashMap<>();
// å¤‡å¿˜å½•
int[][] memo;

/* ä¸»å‡½æ•° */
int findRotateSteps(String ring, String key) {
    int m = ring.length();
    int n = key.length();
    // å¤‡å¿˜å½•å…¨éƒ¨åˆå§‹åŒ–ä¸º 0
    memo = new int[m][n];
    // è®°å½•åœ†ç¯ä¸Šå­—ç¬¦åˆ°ç´¢å¼•çš„æ˜ å°„
    for (int i = 0; i < ring.length(); i++) {
        char c = ring.charAt(i);
        if (!charToIndex.containsKey(c)) {
            charToIndex.put(c, new ArrayList<>());
        }
        charToIndex.get(c).add(i);
    }
    // åœ†ç›˜æŒ‡é’ˆæœ€åˆæŒ‡å‘ 12 ç‚¹é’Ÿæ–¹å‘ï¼Œ
    // ä»ç¬¬ä¸€ä¸ªå­—ç¬¦å¼€å§‹è¾“å…¥ key
    return dp(ring, 0, key, 0);
}

// è®¡ç®—åœ†ç›˜æŒ‡é’ˆåœ¨ ring[i]ï¼Œè¾“å…¥ key[j..] çš„æœ€å°‘æ“ä½œæ•°
int dp(String ring, int i, String key, int j) {
    // base case å®Œæˆè¾“å…¥
    if (j == key.length()) return 0;
    // æŸ¥æ‰¾å¤‡å¿˜å½•ï¼Œé¿å…é‡å å­é—®é¢˜
    if (memo[i][j] != 0) return memo[i][j];
    
    int n = ring.length();
    // åšé€‰æ‹©
    int res = Integer.MAX_VALUE;
    // ring ä¸Šå¯èƒ½æœ‰å¤šä¸ªå­—ç¬¦ key[j]
    for (int k : charToIndex.get(key.charAt(j))) {
        // æ‹¨åŠ¨æŒ‡é’ˆçš„æ¬¡æ•°
        int delta = Math.abs(k - i);
        // é€‰æ‹©é¡ºæ—¶é’ˆè¿˜æ˜¯é€†æ—¶é’ˆ
        delta = Math.min(delta, n - delta);
        // å°†æŒ‡é’ˆæ‹¨åˆ° ring[k]ï¼Œç»§ç»­è¾“å…¥ key[j+1..]
        int subProblem = dp(ring, k, key, j + 1);
        // é€‰æ‹©ã€Œæ•´ä½“ã€æ“ä½œæ¬¡æ•°æœ€å°‘çš„
        // åŠ ä¸€æ˜¯å› ä¸ºæŒ‰åŠ¨æŒ‰é’®ä¹Ÿæ˜¯ä¸€æ¬¡æ“ä½œ
        res = Math.min(res, 1 + delta + subProblem);
    }
    // å°†ç»“æœå­˜å…¥å¤‡å¿˜å½•
    memo[i][j] = res;
    return res;
}
```

è‡³æ­¤ï¼Œè¿™é“é¢˜å°±è§£å†³äº†ã€‚